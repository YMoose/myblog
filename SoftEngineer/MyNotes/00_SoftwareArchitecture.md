# 软件架构
> 本文一般使用Martin Fowler的《企业应用架构模式》的术语
软件架构是什么？
- 软件系统中不变的部分(parts that hard to change)(和设计模式类似)，软件构建人员的共识部分(社会属性)
- 是对抗系统复杂性的手段

在分析构建复杂的系统时，设计者用得最多的技术之一就是分层（系统论中系统的层次性原理），通过添加间接层，将问题分解以控制单个问题的复杂度。（**AI：**神经网络是是否也是这样，chatgpt的成功有一部分来源于模型深度的增加，也就是对问题的解决增加了更多的间接层，让当前的计算能力可以处理间接层的复杂度）
当系统越复杂的时候，层次就会相应增加，不然会导致某一层的复杂度过大。
复杂度过大带来的问题包括
1. 理解性差
2. 维护性差
3. 难以排查错误

> 架构过程中要平衡质量和开发周期
> 如果开发周期长的项目质量很重要，因为一旦不注重质量关注短期的目标，会导致后续的开发周期付出代价
> 如果开发周期极短（临时使用的项目），在整个软件生命周期中可以承受复杂度带来的问题，那就可以减少对质量的关注
> 提升项目质量的关键在于**重构**

## 1. 企业架构（框架） Enterprise Architecture
将企业架构看作当前软件系统最大的尺度。随着复杂度的提升（同时也是随着历史的发展），逐步演变
1. 单一层架构
2. 两层（客户/服务器（CS））架构
3. 三层架构
4. 领域层进一步拆成两层一个放在客户侧负责初步处理显示层数据，另一个放在服务测处理领域逻辑（通常首先假定并不需要这么一层，然后当发现应用确实需要时才增加）
下面介绍的三层架构中的三个基本层，每个基本层又有自己层的架构模式。
我的理解三个基本层和冯·诺依曼结构类似。
### 1.1. 表现层
表现层主要负责提供服务，显示信息。可以将表现层看作冯·诺依曼结构中的I/O。
表示层最常用的套路、模式就是MVC ，MVC就是表示层的一种架构模式。
### 1.2. 领域层
逻辑层主要负责（业务）逻辑实现，是系统中真正的核心。可以将表现层看作冯·诺依曼结构中的运算器和控制器。
业务层的架构模式从简单到复杂有
- 事务脚本模式
- 表模块
- 领域模型模式
可以通过重构逐步改变模式，也可以在系统开发之初根据项目规模选定
### 1.3. 数据源层
数据源层负责与数据库、消息系统、事务管理器及其他软件包通信可以将表现层看作冯·诺依曼结构中的存储单元（持久化）。
持久层的架构模式有入口模式、数据映射器模式等等。
## 2. 架构模式
在企业架构的每一层可以使用符合自己层级的架构模式
### 2.1.1. 表现层-MVC架构模式
### 2.1.2. 表现层-MVP架构模式
### 2.1.3. 表现层-MVVM架构模式
### 2.2.1. 领域层-事务脚本模式
简单地从表示层获得输入，计算后一部分进入数据源层一部分输出回表示层的一个简单过程模型。
适用于领域逻辑简单且不会有过多的变化的场景，一方面其简单易理解，另一方面其过程化的逻辑天然的适应数据输入和输出
### 2.2.2. 领域层-表模块（驱动）模式
是事务脚本和领域模型的一个中间地带。将领域模型中的类和对象抽象为表的形式，同时过程上仍旧采用事务脚本的简单过程模型。使用了表的形式导致无法应用许多在领域模型中可以使用的组织细粒度逻辑结构的技术，例如继承、策略和其他面向对象的设计模式。优点是衔接平滑，表示层与领域层接口和领域层和数据源层都是类数据库操作。
### 2.2.3. 领域层-领域模型模式
适用于领域逻辑复杂的场景，需要花费更多的时间理清当前领域中的实体、联系和行为逻辑。领域模型更为符合现实世界的抽象，也就符合面对对象的抽象方式，现实世界的各个对象间的关系也是错综复杂相互影响的。
## 3. 设计模式
架构模式的实现中会使用到