# 性能分析与优化


`“总之，前途是光明的，道路是曲折的。我们面前困难还多，不可忽视。我们和全体人民团结起来，共同努力，一定能够排除万难，达到胜利的目的。” —— 毛主席`

## 1. 方法论 

### 1.1. 思路
性能提升的思路，可以简单的分为两种，这两种又是可以相互转化的

#### 1.1.1 乐观思路
乐观思路，将性能提升看作目标

> 后续的讲解将以乐观思路为例讲述。

##### 1.1.1.1 步骤
1. 先设立一个性能目标
2. 找到目前可以提升性能最大（其实是性价比最高）的方向并完成它
3. 查看是否完成目标，如未完成目标回到步骤2

#### 1.1.2. 悲观思路
悲观思路，将性能提升看作问题。

##### 1.1.2.1. 步骤
1. 定义目前遇到的性能问题
2. 找到目前影响性能的最大问题并解决它
3. 验证是否已经解决问题，如为解决回到步骤2

### 1.2. 步骤详解

#### 1.2.0. 先验知识

##### 1.2.0.1. 性能分析中的抽象层级
![性能分析中的抽象层级](pics/computer_system_abstract.png)

将常见性能分析的领域按照抽象程度由高到低区分，分为3个大层级:
- 系统层级 system level
  - 分布式系统 distributed system
  - 操作系统 OS (Disk, Network, Graphics, ...)
- 应用层级 application level
  - 多核/多线程 Parallelization/Multithreading
  - 算法复杂度 Algorithm complexity
- 硬件层级 hardware level
  - 硬件架构 hardware architecture
  - 硬件本身 hardware 

低层级的问题最终往往会暴露在高层级，而且这种问题也是最难排查的

#### 1.2.1. 设立性能目标
一个良好的性能目标必须是清晰的可以量化的。
常见的性能指标：
- 吞吐量(Throughout)
- 利用率(Utilization)
- 延迟(Latency)
- 功耗

低层级的性能还有更具体的性能指标描述。
通常来说，性能目标来自于抽象程度最高的层级。
#### 1.2.2. 找到提升性能最大(性价比最高)的方向并完成它
寻找性能提升点是整个过程中最花费时间的。
可以从两个方向寻找。
- 一个自上而下，工作负载分析
  
- 一个自下而上，资源分析
  查看是否是特定资源的问题，比较常见
#### 1.2.3. 查看是否完成了目标

性能是螺旋缓慢提升的，优化操作系统与应用程序相互切换
系统相关:
numa
hugepage
## 性能提升的代价