# 理解Pod和容器设计模式
## 容器
### 本质
一个视图被隔离、资源受限的进程  
容器里PID = 1的进程就是应用本身 => 管理虚拟机 = 管理基础设施；管理容器 = 直接管理应用本身
=> kubernetes管理容器 也就是管理应用 => kubernets是云时代的操作系统 => 容器镜像 = 操作系统的软件安装包  
=> Pos = 进程组
### 问题
因为 容器里PID = 1的进程就是应用本身，那么进程组内其余进程谁负责？
容器是“单进程”模型  
所以为了方便管理，k8s用Pod这个逻辑概念来组成进程组来让k8s对其进行管理
### 设计模型
进程和进程组的模型
## Pod
### 什么时候要用Pod
**超**亲密关系  
亲密关系可以通过调度解决  
如下超亲密关系需要使用pod解决
1. 会发生直接的文件交换
2. 使用localhost或者Socket文件进行本地通讯
3. 会发生非常频繁的RPC调用（此是出于性能考量）
4. 会共享某些Linux Namespace（比如一个容器要加入另一个的Network Namspace）
5. ···
### 如何实现
Pod用于打破隔离，实现共享  
1. 共享网络：k8s会起一个Infra Container，其他的容器会加入这个容器。Pod生命周期跟随这个镜像
2. 共享存储：对应宿主机上的目录
## 容器设计模式 sidecar
在pod里定义专门容器，来执行主业务容器需要的辅助工作。可以将辅助功能与主业务容器解耦，实现独立发布和能力重用。  
例子：
1. 代理容器
2. 适配器容器
